<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Test - Quiz App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-button {
            background: #4caf50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #45a049;
        }
        .results {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
        }
        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Performance Test - Quiz Application</h1>
    
    <div class="test-container">
        <h2>Test 1: Load Questions JSON</h2>
        <p>Test th·ªùi gian t·∫£i file questions.json</p>
        <button class="test-button" onclick="testLoadQuestions()">Test Load Questions</button>
        <div id="load-results"></div>
    </div>

    <div class="test-container">
        <h2>Test 2: Memory Usage</h2>
        <p>Test s·ª≠ d·ª•ng RAM khi load d·ªØ li·ªáu</p>
        <button class="test-button" onclick="testMemoryUsage()">Test Memory Usage</button>
        <div id="memory-results"></div>
    </div>

    <div class="test-container">
        <h2>Test 3: DOM Performance</h2>
        <p>Test hi·ªáu su·∫•t x·ª≠ l√Ω DOM</p>
        <button class="test-button" onclick="testDOMPerformance()">Test DOM Performance</button>
        <div id="dom-results"></div>
    </div>

    <div class="test-container">
        <h2>Test 4: Full Application</h2>
        <p>Test to√†n b·ªô ·ª©ng d·ª•ng quiz</p>
        <button class="test-button" onclick="testFullApp()">Test Full App</button>
        <div id="app-results"></div>
    </div>

    <script>
        let questions = [];
        let startTime, endTime;

        async function testLoadQuestions() {
            const resultsDiv = document.getElementById('load-results');
            resultsDiv.innerHTML = '<p>ƒêang test...</p>';
            
            startTime = performance.now();
            
            try {
                const response = await fetch('questions.json');
                questions = await response.json();
                endTime = performance.now();
                
                const loadTime = endTime - startTime;
                const fileSize = JSON.stringify(questions).length;
                const memorySize = (fileSize / 1024 / 1024).toFixed(2);
                
                resultsDiv.innerHTML = `
                    <div class="results">
                        <h3>K·∫øt qu·∫£ Test Load:</h3>
                        <p><strong>Th·ªùi gian t·∫£i:</strong> ${loadTime.toFixed(2)}ms</p>
                        <p><strong>S·ªë c√¢u h·ªèi:</strong> ${questions.length}</p>
                        <p><strong>K√≠ch th∆∞·ªõc file:</strong> ${memorySize}MB</p>
                        <p><strong>Tr·∫°ng th√°i:</strong> ‚úÖ Th√†nh c√¥ng</p>
                    </div>
                `;
            } catch (error) {
                let errorMessage = error.message;
                let solutionMessage = '';
                
                if (errorMessage.includes('CORS') || errorMessage.includes('Failed to fetch')) {
                    errorMessage = 'L·ªói CORS - Kh√¥ng th·ªÉ t·∫£i file JSON';
                    solutionMessage = `
                        <div class="error">
                            <h3>üîß Gi·∫£i ph√°p:</h3>
                            <p><strong>Kh·ªüi ƒë·ªông Local Server:</strong></p>
                            <ol>
                                <li>M·ªü Command Prompt trong th∆∞ m·ª•c qa-viewer</li>
                                <li>Ch·∫°y: <code>python -m http.server 8000</code></li>
                                <li>Truy c·∫≠p: <code>http://localhost:8000/performance-test.html</code></li>
                            </ol>
                            <p><strong>Ho·∫∑c:</strong></p>
                            <ul>
                                <li>S·ª≠ d·ª•ng VS Code Live Server extension</li>
                                <li>Ho·∫∑c ch·∫°y file <code>start-server.bat</code></li>
                            </ul>
                        </div>
                    `;
                } else {
                    solutionMessage = '<p>Vui l√≤ng ki·ªÉm tra file questions.json c√≥ t·ªìn t·∫°i v√† ƒë√∫ng format</p>';
                }
                
                resultsDiv.innerHTML = `
                    <div class="error">
                        <h3>‚ùå L·ªói:</h3>
                        <p>${errorMessage}</p>
                        ${solutionMessage}
                    </div>
                `;
            }
        }

        function testMemoryUsage() {
            const resultsDiv = document.getElementById('memory-results');
            resultsDiv.innerHTML = '<p>ƒêang test...</p>';
            
            if (questions.length === 0) {
                resultsDiv.innerHTML = `
                    <div class="error">
                        <p>Vui l√≤ng ch·∫°y Test 1 tr∆∞·ªõc</p>
                    </div>
                `;
                return;
            }
            
            startTime = performance.now();
            
            // Simulate processing questions
            let processedQuestions = 0;
            const batchSize = 100;
            
            for (let i = 0; i < questions.length; i += batchSize) {
                const batch = questions.slice(i, i + batchSize);
                processedQuestions += batch.length;
                
                // Simulate some processing
                batch.forEach(q => {
                    const processed = {
                        id: q.id,
                        question: q.question,
                        options: q.options,
                        correct: q.correct
                    };
                });
            }
            
            endTime = performance.now();
            const processTime = endTime - startTime;
            
            resultsDiv.innerHTML = `
                <div class="results">
                    <h3>K·∫øt qu·∫£ Test Memory:</h3>
                    <p><strong>Th·ªùi gian x·ª≠ l√Ω:</strong> ${processTime.toFixed(2)}ms</p>
                    <p><strong>C√¢u h·ªèi ƒë√£ x·ª≠ l√Ω:</strong> ${processedQuestions}</p>
                    <p><strong>Batch size:</strong> ${batchSize}</p>
                    <p><strong>Tr·∫°ng th√°i:</strong> ‚úÖ Th√†nh c√¥ng</p>
                </div>
            `;
        }

        function testDOMPerformance() {
            const resultsDiv = document.getElementById('dom-results');
            resultsDiv.innerHTML = '<p>ƒêang test...</p>';
            
            if (questions.length === 0) {
                resultsDiv.innerHTML = `
                    <div class="error">
                        <p>Vui l√≤ng ch·∫°y Test 1 tr∆∞·ªõc</p>
                    </div>
                `;
                return;
            }
            
            startTime = performance.now();
            
            // Create test DOM elements
            const testContainer = document.createElement('div');
            testContainer.style.display = 'none';
            document.body.appendChild(testContainer);
            
            // Simulate creating question elements
            for (let i = 0; i < Math.min(100, questions.length); i++) {
                const questionDiv = document.createElement('div');
                questionDiv.innerHTML = `
                    <h3>${questions[i].question}</h3>
                    <div class="options">
                        <button>A: ${questions[i].options.A}</button>
                        <button>B: ${questions[i].options.B}</button>
                        <button>C: ${questions[i].options.C}</button>
                        <button>D: ${questions[i].options.D}</button>
                    </div>
                `;
                testContainer.appendChild(questionDiv);
            }
            
            endTime = performance.now();
            const domTime = endTime - startTime;
            
            // Cleanup
            document.body.removeChild(testContainer);
            
            resultsDiv.innerHTML = `
                <div class="results">
                    <h3>K·∫øt qu·∫£ Test DOM:</h3>
                    <p><strong>Th·ªùi gian t·∫°o DOM:</strong> ${domTime.toFixed(2)}ms</p>
                    <p><strong>Elements t·∫°o:</strong> ${Math.min(100, questions.length)}</p>
                    <p><strong>Tr·∫°ng th√°i:</strong> ‚úÖ Th√†nh c√¥ng</p>
                </div>
            `;
        }

        function testFullApp() {
            const resultsDiv = document.getElementById('app-results');
            resultsDiv.innerHTML = '<p>ƒêang test...</p>';
            
            if (questions.length === 0) {
                resultsDiv.innerHTML = `
                    <div class="error">
                        <p>Vui l√≤ng ch·∫°y Test 1 tr∆∞·ªõc</p>
                    </div>
                `;
                return;
            }
            
            startTime = performance.now();
            
            // Simulate full app initialization
            const app = {
                questions: questions,
                currentIndex: 0,
                score: { correct: 0, wrong: 0 },
                wrongAnswers: [],
                userAnswers: []
            };
            
            // Simulate processing first 10 questions
            for (let i = 0; i < Math.min(10, questions.length); i++) {
                const question = app.questions[i];
                const userAnswer = Object.keys(question.options)[Math.floor(Math.random() * 4)];
                const isCorrect = userAnswer === question.correct;
                
                if (isCorrect) {
                    app.score.correct++;
                } else {
                    app.score.wrong++;
                    app.wrongAnswers.push({
                        question: question.question,
                        userAnswer: userAnswer,
                        correctAnswer: question.correct
                    });
                }
                
                app.userAnswers[i] = userAnswer;
            }
            
            endTime = performance.now();
            const appTime = endTime - startTime;
            
            resultsDiv.innerHTML = `
                <div class="results">
                    <h3>K·∫øt qu·∫£ Test Full App:</h3>
                    <p><strong>Th·ªùi gian kh·ªüi t·∫°o:</strong> ${appTime.toFixed(2)}ms</p>
                    <p><strong>C√¢u h·ªèi test:</strong> ${Math.min(10, questions.length)}</p>
                    <p><strong>ƒêi·ªÉm s·ªë:</strong> ${app.score.correct}/${app.score.correct + app.score.wrong}</p>
                    <p><strong>Tr·∫°ng th√°i:</strong> ‚úÖ Th√†nh c√¥ng</p>
                </div>
            `;
        }

        // Auto-run first test on page load
        window.addEventListener('load', () => {
            setTimeout(testLoadQuestions, 1000);
        });
    </script>
</body>
</html>
